<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hp.ssm.dao.UserDao">
    <sql id="Base_Column_List">
            id,
            email,
            `password`,
            `name`,
            sex,
            address,
            phone,
            idnumber,
            money,
            twostepsecret,
            isactive,
            rnauth,
            pic,
            verified,
            `type`
    </sql>
    <resultMap id="BaseResultMap" type="com.hp.ssm.model.User">
        <result column="id" property="id"/>
        <result column="email" property="email"/>
        <result column="password" property="password"/>
        <result column="name" property="name"/>
        <result column="sex" property="sex"/>
        <result column="address" property="address"/>
        <result column="phone" property="phone"/>
        <result column="idnumber" property="idNumber"/>
        <result column="money" property="money"/>
        <result column="two_steps_secret" property="twoStepsSecret"/>
        <result column="isactive" property="isActive"/>
        <result column="rnauth" property="rnauth"/>
        <result column="pic" property="pic"/>
        <result column="verified" property="verified"/>
        <result column="type" property="type"/>
    </resultMap>
    <insert id="addUser" parameterType="com.hp.ssm.model.User" useGeneratedKeys="true" keyProperty="user.id"
            keyColumn="id">
        insert into user (email, name, password, isactive, money, rnauth, type)
        values (#{user.email}, #{user.name}, #{user.password}, 0, 0, 0, 0)
    </insert>
    <select id="getExceptionUserByEmail" parameterType="java.lang.String" resultType="java.lang.Long">
        select count(id)
        from user
        where email = #{email}
    </select>
    <update id="setUserActive">
        update user
        set isactive = true
        where id = #{id}
    </update>
    <select id="getPasswordByEmail" resultType="java.lang.String">
        select password
        from user
        where email = #{email}
    </select>
    <select id="getUserByEmail" parameterType="java.lang.String" resultType="com.hp.ssm.model.User">
        select id,
               email,
               name,
               sex,
               address,
               phone,
               idnumber,
               money,
               isactive,
               rnauth,
               type
        from user
        where email = #{email}
    </select>

    <select id="getUserById" resultType="com.hp.ssm.model.User">
        select id,
               email,
               name,
               sex,
               address,
               phone,
               idnumber,
               money,
               isactive,
               rnauth,
               type
        from user
        where id = #{id}
    </select>


    <select id="getSecretByEmail" resultType="java.lang.String">
        select twostepsecret
        from user
        where email = #{email}
    </select>
    <update id="updateSecretByEmail">
        update user
        set twostepsecret = #{secret}
        where email = #{email}
    </update>
    <update id="setTwoStepsActive">
        update user
        set rnauth = true
        where email = #{email}
    </update>
    <update id="setTwoStepsUnActive">
        update user
        set rnauth = false
        where email = #{email}
    </update>
    <select id="checkTwoStepsActiveByEmail" resultType="java.lang.Boolean">
        select rnauth
        from user
        where email = #{email}
    </select>
    <update id="updateUser">
        update user
        set address =#{address},
            phone=#{phone},
            idnumber=#{idNumber}
        where id = #{id}
    </update>
    <update id="userRealNameAuth">
        update user
        set idnumber=#{idNumber},
            verified = 1
        where id = #{userId}
    </update>
    <insert id="addUserPic">
        update user
        set pic = #{userPic}
        where id = #{userId}
    </insert>
    <select id="getUserPic" resultType="java.lang.String">
        select pic
        from user
        where id = #{userId}
    </select>

    <!--auto generated by MybatisCodeHelper on 2019-04-24-->
    <update id="updateVerifiedById">
        update user
        set verified=#{updatedVerified}
        where email = #{email}
    </update>

    <!--auto generated by MybatisCodeHelper on 2019-04-24-->
    <select id="getByRnauthAndType" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from user
        where verified=#{verify} and `type`=#{type}
    </select>

    <!--auto generated by MybatisCodeHelper on 2019-04-24-->
    <select id="getUserListByType" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from user
        where `type`=#{type}
    </select>
    <update id="resetPwd">
        update user
        set password = #{newPwd,jdbcType=VARCHAR}
        where email = #{email,jdbcType=VARCHAR}
    </update>

    <!--auto generated by MybatisCodeHelper on 2019-04-25-->
    <update id="updateById">
        update user
        <set>
            <if test="updated.email != null">
                email = #{updated.email},
            </if>
            <if test="updated.password != null">
                password = #{updated.password},
            </if>
            <if test="updated.name != null">
                name = #{updated.name},
            </if>
            <if test="updated.sex != null">
                sex = #{updated.sex},
            </if>
            <if test="updated.address != null">
                address = #{updated.address},
            </if>
            <if test="updated.phone != null">
                phone = #{updated.phone},
            </if>
            <if test="updated.idNumber != null">
                idnumber = #{updated.idNumber},
            </if>
            <if test="updated.money != null">
                money = #{updated.money},
            </if>
            <if test="updated.twoStepsSecret != null">
                twostepsecret = #{updated.twoStepsSecret},
            </if>
            <if test="updated.isActive != null">
                isactive = #{updated.isActive},
            </if>
            <if test="updated.rnauth != null">
                rnauth = #{updated.rnauth},
            </if>
            <if test="updated.pic != null">
                pic = #{updated.pic},
            </if>
            <if test="updated.verified != null">
                verified = #{updated.verified},
            </if>
            <if test="updated.type != null">
                type = #{updated.type},
            </if>
        </set>
        where id=#{updated.id}
    </update>


</mapper>
