<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hp.ssm.dao.UserDao">
    <insert id="addUser" parameterType="com.hp.ssm.model.User" useGeneratedKeys="true" keyProperty="user.id"
            keyColumn="id">
        insert into user (email, name, password, isactive, money, rnauth)
        values (#{user.email}, #{user.name}, #{user.password}, 0, 0, 0)
    </insert>
    <select id="getExceptionUserByEmail" parameterType="java.lang.String" resultType="java.lang.Long">
        select count(id)
        from user
        where email = #{email}
    </select>
    <update id="setUserActive">
        update user
        set isactive = true
        where id = #{id}
    </update>
    <select id="getPasswordByEmail" parameterType="com.hp.ssm.model.User" resultType="java.lang.String">
        select password
        from user
        where email = #{email}
    </select>
    <select id="getUserByEmail" parameterType="java.lang.String" resultType="com.hp.ssm.model.User">
        select id,
               email,
               name,
               sex,
               address,
               phone,
               idnumber,
               money,
               isactive,
               rnauth
        from user
        where email = #{email}
    </select>

    <select id="getUserById" resultType="com.hp.ssm.model.User">
        select id,
               email,
               name,
               sex,
               address,
               phone,
               idnumber,
               money,
               isactive,
               rnauth
        from user
        where id = #{id}
    </select>


    <select id="getSecretByEmail" resultType="java.lang.String">
        select twostepsecret
        from user
        where email = #{email}
    </select>
    <update id="updateSecretByEmail">
        update user
        set twostepsecret = #{secret}
        where email = #{email}
    </update>
    <update id="setTwoStepsActive">
        update user
        set rnauth = true
        where email = #{email}
    </update>
    <update id="setTwoStepsUnActive">
        update user
        set rnauth = false
        where email = #{email}
    </update>
    <select id="checkTwoStepsActiveByEmail" resultType="java.lang.Boolean">
        select rnauth
        from user
        where email = #{email}
    </select>
    <update id="updateUser">
        update user
        set address =#{address},
            phone=#{phone},
            idnumber=#{idNumber}
        where id = #{id}
    </update>
    <update id="userRealNameAuth">
        update user
        set idnumber=#{idNumber}
        where id = #{userId}
    </update>
    <insert id="addUserPic">
        update user
        set pic = #{userPic}
        where id = #{userId}
    </insert>
    <select id="getUserPic" resultType="java.lang.String">
        select pic
        from user
        where id = #{userId}
    </select>
    <update id="addMissionRate">
        update mission
        set rate = rate + 1
        where id = #{missionId}
    </update>
</mapper>
